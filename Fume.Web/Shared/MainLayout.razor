@inherits LayoutComponentBase
@inject NavigationManager navigationManager
<MudThemeProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Elevation="2" Dense="true" Color="Color.Info">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@((e) => DrawerToggle())" />
        <div class="logo-section" @onclick="GoToHome" style="cursor: pointer;">
            <img src="/Logo.png" alt="Fume Logo" style="border-radius: 45px; height:42px !important" />
        </div>
      @*   <MudText Typo="Typo.h6" Class="ml-3">Fume Marketplace</MudText> *@
        <MudSpacer />
        <AuthLinks />
        <MudIconButton Icon="@Icons.Material.Filled.Info" Color="Color.Inherit"  Target="_blank" />
    </MudAppBar>

    <AuthorizeView Roles="Admin">
        <Authorized>
            <MudDrawer @bind-Open="_drawerOpen"
                       Elevation="2"
                       ClipMode="DrawerClipMode.Always"
                       Variant="@DrawerVariant.Mini"
                       OpenMiniOnHover="true">

                <NavMenu />
            </MudDrawer>
        </Authorized>
        <NotAuthorized>
            <MudDrawer @bind-Open="_drawerOpen"
                       Elevation="2"
                       ClipMode="DrawerClipMode.Always"
                       Variant="@DrawerVariant.Mini"
                       OpenMiniOnHover="true">

                <NavMenu />
            </MudDrawer>
        </NotAuthorized>
    </AuthorizeView>

    <MudMainContent >
        <MudContainer MaxWidth="MaxWidth.ExtraLarge" Style="margin-top: 0px !important;background-color: aliceblue;     padding-left: 0px !important;padding-right: 0px !important; min-height: calc(100vh - 64px); display: flex; flex-direction: column;">
            <div style="flex: 1;">
                @Body
            </div>
            <Footer />
        </MudContainer>
    </MudMainContent>

    <!-- Botón flotante de WhatsApp -->
    <WhatsAppButton PhoneNumber="573001234567"
                    Message="Hola, me gustaría solicitar información sobre servicios o cotizaciones de ITplus." />
</MudLayout>

@code {
    private bool _drawerOpen = true;
    private bool firstRender = true;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            DrawerToggle();
            StateHasChanged();
        }
    }

    private void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }

    private void GoToHome()
    {
        navigationManager.NavigateTo("/", forceLoad: false);
    }
}
